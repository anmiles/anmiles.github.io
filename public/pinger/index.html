<!DOCTYPE html>
<html>
<head>
	<title>Pinger</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="DC.date" content="2024-04-04">
</head>
<body>

<style type="text/css">
	html, body, textarea {
		display: block;
		width: 100vw;
		height: 100vh;
		margin: 0;
		border: 0;
		outline: 0;
		box-sizing: border-box;
	}
</style>

<textarea readonly></textarea>

<script type="text/javascript">
	const timeout = 5000;

	async function ping(url) {
		return new Promise((resolve, reject) => {
			const img = new Image();
			const timer = setTimeout(() => reject(timeout), timeout);
			const startTime = new Date().getTime();
			img.onload = img.onerror = () => { clearTimeout(timer); resolve((new Date().getTime() - startTime)) };
			img.src = url + '?t=' + Math.random().toString().slice(2);
		})
	}

	(async function(){
		const textarea = document.querySelector('textarea');

		const allUrls = {
			sbg: {
				game_app : 'https://sbg-game.ru/app',
				game_desktop : 'https://sbg-game.ru/app/intel.js',
				game_mobile : 'https://sbg-game.ru/app/script.js',
				plus_desktop : 'https://anmiles.net/userscripts/sbg.plus.user.js',
				plus_mobile : 'https://anmiles.net/userscripts/sbg.plus.user.min.js',
				plus_source : 'https://raw.githubusercontent.com/anmiles/userscripts/main/src/sbg.plus.user.ts',
				cui_mobile : 'https://raw.githubusercontent.com/nicko-v/sbg-cui/main/index.js',
				eui_mobile : 'https://github.com/egorantonov/sbg-enhanced/releases/latest/download/eui.user.js',
			}
		};

		const urls = allUrls[location.search.slice(1)];

		if (urls) {
			const maxKeyLength = Math.max(...Object.keys(urls).map(key => key.length));

			for (const key in urls) {
				textarea.value += key + ' '.repeat(maxKeyLength - key.length) + ' => ';

				try {
					const result = await ping(urls[key]);
					textarea.value += `PASS: ${result}ms\n`;
				} catch (result) {
					textarea.value += `FAIL: ${result}ms timeout\n`;
				}
			}
		}
	})();
</script>

</body>
</html>
